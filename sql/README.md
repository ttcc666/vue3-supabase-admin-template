# ğŸš€ Vue3 Supabase Admin Template æ•°æ®åº“è„šæœ¬

## ğŸ“‹ æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„Vue3 Supabaseç®¡ç†æ¨¡æ¿æ•°æ®åº“ç³»ç»Ÿï¼ŒåŒ…å«ï¼š

- âœ… **ç”¨æˆ·èµ„æ–™ç®¡ç†** (profilesè¡¨)
- âœ… **ç”¨æˆ·æ´»åŠ¨è®°å½•** (user_activitiesè¡¨)
- âœ… **ç”¨æˆ·è®¾ç½®ç®¡ç†** (user_settingsè¡¨)
- âœ… **æ™ºèƒ½ç”¨æˆ·åç”Ÿæˆ** (è§£å†³çº¦æŸå†²çª)
- âœ… **è¡Œçº§å®‰å…¨ç­–ç•¥** (RLS)
- âœ… **å¤´åƒä¸Šä¼ æ”¯æŒ** (Storageé…ç½®)
- âœ… **å®æ—¶åŒæ­¥æ”¯æŒ** (Realtime)
- âœ… **è‡ªåŠ¨æ¸…ç†æœºåˆ¶** (å¯é€‰å®šæ—¶ä»»åŠ¡)
- âœ… **å®Œæ•´çš„æƒé™ç®¡ç†**

## ğŸ¯ æ¨èå®‰è£…æ–¹å¼

### ğŸŒŸ æ–¹æ³•1: å®Œæ•´åº”ç”¨åˆå§‹åŒ–ï¼ˆæ¨èï¼‰

ä½¿ç”¨ç»Ÿä¸€çš„åˆå§‹åŒ–è„šæœ¬ï¼Œä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰åŠŸèƒ½ï¼š

1. ç™»å½•åˆ°æ‚¨çš„ [Supabase Dashboard](https://app.supabase.com)
2. é€‰æ‹©æ‚¨çš„é¡¹ç›®
3. è¿›å…¥ **SQL Editor**
4. å¤åˆ¶ `sql/complete_app_setup.sql` çš„å…¨éƒ¨å†…å®¹
5. ç²˜è´´å¹¶ç‚¹å‡» **Run** æ‰§è¡Œ

### æ–¹æ³•2: ä»…ç”¨æˆ·è®¾ç½®ç³»ç»Ÿ

å¦‚æœåªéœ€è¦ç”¨æˆ·è®¾ç½®åŠŸèƒ½ï¼š

1. å¤åˆ¶ `sql/03_user_settings_setup_simple.sql` çš„å†…å®¹
2. åœ¨ SQL Editor ä¸­æ‰§è¡Œ

### æ–¹æ³•3: ä½¿ç”¨psqlå‘½ä»¤è¡Œ

```bash
# è¿æ¥åˆ°æ‚¨çš„Supabaseæ•°æ®åº“
psql "postgresql://postgres:[YOUR-PASSWORD]@[YOUR-PROJECT-REF].supabase.co:5432/postgres"

# æ‰§è¡Œå®Œæ•´åˆå§‹åŒ–è„šæœ¬
\i sql/complete_app_setup.sql
```

## âœ… éªŒè¯å®‰è£…

### å®Œæ•´å®‰è£…æˆåŠŸæ¶ˆæ¯

```text
ğŸ‰ Vue3 Supabase Admin Template æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼
âœ… å·²åˆ›å»ºçš„è¡¨:
   ğŸ“‹ profiles - ç”¨æˆ·èµ„æ–™è¡¨
   ğŸ“Š user_activities - ç”¨æˆ·æ´»åŠ¨è®°å½•è¡¨
   âš™ï¸  user_settings - ç”¨æˆ·è®¾ç½®è¡¨
âœ… å·²åˆ›å»ºçš„åŠŸèƒ½:
   ğŸ” å®Œæ•´çš„RLSç­–ç•¥
   ğŸ“ Storageé…ç½®ï¼ˆå¤´åƒä¸Šä¼ ï¼‰
   ğŸ”„ å®æ—¶è®¢é˜…
   ğŸ› ï¸  ä¸šåŠ¡å‡½æ•°å’Œè§¦å‘å™¨
```

## ğŸ”§ çº¦æŸä¿®å¤

å¦‚æœé‡åˆ° `setting_value_valid` çº¦æŸé”™è¯¯ï¼Œè¯·æ‰§è¡Œä¿®å¤è„šæœ¬ï¼š

```sql
-- åœ¨ SQL Editor ä¸­æ‰§è¡Œ
\i sql/fix_constraint.sql
```

æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œï¼š

```sql
-- åˆ é™¤æ—§çº¦æŸ
ALTER TABLE public.user_settings DROP CONSTRAINT IF EXISTS setting_value_valid;

-- æ·»åŠ æ–°çº¦æŸï¼ˆæ”¯æŒå¤šç§JSONç±»å‹ï¼‰
ALTER TABLE public.user_settings ADD CONSTRAINT setting_value_valid 
CHECK (jsonb_typeof(setting_value) IN ('object', 'string', 'boolean', 'number'));
```

## ğŸ“Š æ•°æ®åº“ç»“æ„

### æ ¸å¿ƒè¡¨ç»“æ„

#### profilesè¡¨ - ç”¨æˆ·èµ„æ–™
- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€ç”¨æˆ·åã€è”ç³»æ–¹å¼ï¼‰
- ç¤¾äº¤åª’ä½“é“¾æ¥ï¼ˆGitHubã€LinkedInã€Twitterï¼‰
- è‡ªåŠ¨ç”Ÿæˆçš„å…¨åå­—æ®µ
- å¤´åƒä¸Šä¼ æ”¯æŒ

#### user_activitiesè¡¨ - æ´»åŠ¨è®°å½•
- æ´»åŠ¨ç±»å‹æšä¸¾ï¼ˆç™»å½•ã€ç™»å‡ºã€èµ„æ–™æ›´æ–°ç­‰ï¼‰
- æ´»åŠ¨æ ‡é¢˜å’Œæè¿°
- IPåœ°å€å’Œç”¨æˆ·ä»£ç†
- JSONå…ƒæ•°æ®
- æ—¶é—´æˆ³

#### user_settingsè¡¨ - ç”¨æˆ·è®¾ç½®
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| user_id | UUID | ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰ |
| category | setting_category | è®¾ç½®åˆ†ç±» |
| setting_key | VARCHAR(100) | è®¾ç½®é”®å |
| setting_value | JSONB | è®¾ç½®å€¼ |
| description | TEXT | è®¾ç½®æè¿° |
| is_active | BOOLEAN | æ˜¯å¦æ¿€æ´» |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ |

### æšä¸¾ç±»å‹

#### activity_type - æ´»åŠ¨ç±»å‹
- `login` - ç™»å½•ç³»ç»Ÿ
- `logout` - é€€å‡ºç™»å½•
- `profile_update` - æ›´æ–°èµ„æ–™
- `password_change` - ä¿®æ”¹å¯†ç 
- `avatar_upload` - ä¸Šä¼ å¤´åƒ
- `email_change` - ä¿®æ”¹é‚®ç®±
- `phone_update` - æ›´æ–°æ‰‹æœº
- `security_setting` - å®‰å…¨è®¾ç½®
- `account_setting` - è´¦æˆ·è®¾ç½®

#### setting_category - è®¾ç½®åˆ†ç±»
- `system` - ç³»ç»Ÿè®¾ç½®ï¼šè¯­è¨€ã€æ—¶åŒºã€æ—¥æœŸæ ¼å¼
- `notification` - é€šçŸ¥è®¾ç½®ï¼šé‚®ä»¶ã€æµè§ˆå™¨ã€çŸ­ä¿¡ã€è¥é”€é€šçŸ¥
- `privacy` - éšç§è®¾ç½®ï¼šèµ„æ–™å¯è§æ€§ã€æ´»åŠ¨çŠ¶æ€ã€æ•°æ®åˆ†æ

### å…³é”®å‡½æ•°
- `generate_valid_username()` - æ™ºèƒ½ç”¨æˆ·åç”Ÿæˆ
- `log_user_activity()` - è®°å½•ç”¨æˆ·æ´»åŠ¨
- `get_user_activity_stats()` - è·å–æ´»åŠ¨ç»Ÿè®¡
- `get_user_setting()` - è·å–ç”¨æˆ·è®¾ç½®
- `update_user_setting()` - æ›´æ–°ç”¨æˆ·è®¾ç½®
- `cleanup_old_activities()` - æ¸…ç†æ—§è®°å½•

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æ‰§è¡Œè„šæœ¬æ—¶å‡ºç°æƒé™é”™è¯¯**
A: ç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯é¡¹ç›®çš„postgresç”¨æˆ·è¿æ¥

**Q: setting_value_validçº¦æŸé”™è¯¯**
A: æ‰§è¡Œ `sql/fix_constraint.sql` ä¿®å¤çº¦æŸæ¡ä»¶

**Q: é»˜è®¤è®¾ç½®æœªåˆ›å»º**
A: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œè„šæœ¬éœ€è¦åœ¨è®¤è¯ç”¨æˆ·ä¸‹æ‰§è¡Œ

### æ‰‹åŠ¨ä¿®å¤

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œæ¸…ç†ï¼š

```sql
-- æ¸…ç†æ—§çš„è®¾ç½®è¡¨
DROP TABLE IF EXISTS public.user_settings CASCADE;
DROP TYPE IF EXISTS setting_category CASCADE;

-- ç„¶åé‡æ–°æ‰§è¡Œå®‰è£…è„šæœ¬
```

## ğŸ‰ å®Œæˆ

å®‰è£…å®Œæˆåï¼Œæ‚¨çš„åº”ç”¨å°±å…·å¤‡äº†å®Œæ•´çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- ğŸ‘¤ **ç”¨æˆ·èµ„æ–™ç®¡ç†** - å®Œæ•´çš„ä¸ªäººä¿¡æ¯ç®¡ç†
- ğŸ“ **æ´»åŠ¨è®°å½•è¿½è¸ª** - è‡ªåŠ¨è®°å½•ç”¨æˆ·æ“ä½œ
- âš™ï¸ **ä¸ªæ€§åŒ–è®¾ç½®** - çµæ´»çš„ç”¨æˆ·é…ç½®ç³»ç»Ÿ
- ğŸ–¼ï¸ **å¤´åƒä¸Šä¼ ** - å®‰å…¨çš„æ–‡ä»¶å­˜å‚¨
- ğŸ”„ **å®æ—¶æ•°æ®åŒæ­¥** - å³æ—¶æ›´æ–°ä½“éªŒ

æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«å®‰å…¨åœ°å­˜å‚¨ï¼Œå¹¶æ”¯æŒå®æ—¶åŒæ­¥ã€‚

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥Supabase Dashboardçš„æ—¥å¿—æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

- `complete_app_setup.sql` - ğŸŒŸ **æ¨è** å®Œæ•´åº”ç”¨åˆå§‹åŒ–è„šæœ¬
- `03_user_settings_setup_simple.sql` - ä»…ç”¨æˆ·è®¾ç½®ç³»ç»Ÿ
- `00_complete_setup.sql` - ç”¨æˆ·èµ„æ–™å’Œæ´»åŠ¨è®°å½•ç³»ç»Ÿ
- `02_system_validation_tests.sql` - ç³»ç»ŸéªŒè¯æµ‹è¯•è„šæœ¬
- `fix_constraint.sql` - çº¦æŸä¿®å¤è„šæœ¬
